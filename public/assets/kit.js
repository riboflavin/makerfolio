(function(a){a.KitSteps=function(m){var e=a.Component({id:"kit",components:{}},m),h=[];var k=$("#step-div");var g=['<tr data-id="{{id}}" data-step="{{num}}">','<td class="k-kit-steps-td">','<div class="k-kit-step-div">','<div class="k-step-ctrls">','<a href="javascript:void(0)" class="k-kit-ctrls-edit btn btn-small btn-primary">edit</a>','<a href="javascript:void(0)" class="k-kit-ctrls-delete btn btn-small btn-danger">delete</a>',"</div>",'<div class="k-step-title-container">','<input class="k-kit-step-order-edit span1" value="{{num}}"></input>','<p class="k-kit-step-num">{{num}}) </p>','<p class="k-kit-step-title">{{optional}}{{title}}</p>',"</div>",'<div data-ftype="step" data-id="{{id}}" class="kit-img-container kit-img-empty pull-left fileupload"></div>','<p class="k-kit-step-instructions">{{instructions}}</p>',"</div>","</td></tr>"].join("");var l=['<tr data-id="{{id}}" data-step="{{num}}">','<td class="k-kit-steps-td-fixed">','<div class="k-kit-step-div">','<div class="k-step-title-container-fixed">','<p class="k-kit-step-num">{{num}}) </p>','<p class="k-kit-step-title">{{#optional}}{{optional}}{{/optional}} {{title}}</p>',"</div>",'{{#thumb_url}}<div data-id="{{id}}" data_url="{{url}}" class="kit-img-container-max kit-img-container cursor-pointer">','<img class="k-kit-step-img" src="{{thumb_url}}">',"</img>","</div>{{/thumb_url}}",'<p class="k-kit-step-instructions">{{instructions}}</p>',"</div>","</td></tr>"].join("");var f=l;if($("#kit").hasClass("editable")){f=g}function j(n){var o=$.extend(true,{},n);n.optional?o.optional="(Optional) ":o.optional="";o.num=parseInt(n.num);return o}function b(n,o){var p=j(o),q=a.template(f,p);$(q).appendTo(n).data("step",o).find(".k-step-ctrls:first").hide();$(a).trigger("step-row-created",o)}function c(n,o){var p=j(o),q=a.template(f,p);n.replaceWith($(q).data("step",o));$(a).trigger("step-row-created",o)}function d(o){var n=$("tbody",k).empty();if(o.length){$.each(o,function(p,q){b(n,q)});k.show()}}e.oninit=function(){e.pub.username=$("#kit").attr("data-username");e.pub.slug=$("#kit").attr("data-id");e.pub.token=$("#kit").attr("data-token");a.Data.get("/"+e.pub.username+"/"+e.pub.slug+"/steps",function(n){d(n);$(".k-step-ctrls").hide()});$(a).bind("step-created",function(n,o){k.show();b($("tbody",k),o)});$(a).bind("step-updated",function(o,p,n){c(n,p)});$(a).bind("step-deleted",function(n,o){if(!$("tbody tr",k).length){k.hide()}})};return e.pub}})(Kitify);(function(a){a.NewStep=function(c){var b=a.Component({id:"newstep",fields:[{id:"newstep-title",prop:"title",label:"Step Title",required:true,submit:true},{id:"newstep-optional",prop:"optional",label:"Optional",required:false,submit:true},{id:"newstep-thumb",prop:"thumb",required:false,submit:true},{id:"newstep-instructions",label:"Step Instructions",prop:"instructions",required:true,submit:true}]},c);b.oninit=function(){b.manager.username=$("#kit").attr("data-username");b.manager.slug=$("#kit").attr("data-id");b.manager.token=$("#kit").attr("data-token");var d=a.Form.setup({context:"#newstep",fields:b.options.fields,btns:{submit:"#kit-add-step-btn"}});$(d).bind("submit",function(e,f){e.preventDefault();f.token=b.manager.token;a.Data.save("/"+b.manager.username+"/"+b.manager.slug+"/steps",f,function(g){if(g&&g.success!==false){d.reset();$(a).trigger("step-created",[g])}})})};return b.pub}})(Kitify);(function(a){a.EditStep=function(f){var c=a.Component({id:"editstep",fields:[{id:"step-title",prop:"title",label:"Step title",required:true,submit:true},{id:"step-optional",prop:"optional",required:false,submit:true},{id:"step-thumb",prop:"thumb",required:false,submit:true},{id:"step-instructions",label:"instructions",prop:"instructions",required:true,submit:true}]},f);var e;var b=['<tr class="k-steps-editrow" data-step="{{num}}" data-id="{{id}}">','<td class="k-kit-steps-td">','<div class="k-kit-step-div">','<div class="k-step-ctrls">','<a href="javascript:void(0)" class="k-kit-ctrls-save btn btn-small btn-primary">save</a>','<a href="javascript:void(0)" class="k-kit-ctrls-cancel btn btn-small">cancel</a>',"</div>",'<input type="text" id="step-title" value="{{title}}" class="span5" required />','<label for="step-optional">','<input type="checkbox" id="step-optional" value="{{optional}}" {{#optional}}checked="checked"{{/optional}}>Optional step?',"</label>",'<div class="img-contain-placeholder"></div>','<textarea id="step-instructions" length="1000" rows="4" class="span7" required>{{instructions}}</textarea>',"</div>","</td></tr>"].join("");function d(h){var l=h.data("step");var j=h.find(".kit-img-container:first");if(l){var m=$(a.template(b,l)).insertAfter(h);m.find(".img-contain-placeholder:first").replaceWith(j);var k=a.Form.setup({context:m,fields:c.options.fields,data:l,btns:{submit:$(".k-kit-ctrls-save",m)}});$(k).bind("submit",function(n,o){o.token=c.manager.token;a.Data.save("/"+c.manager.username+"/"+c.manager.slug+"/steps/"+o.id,o,function(p){if(p&&p.success!==false){m.remove();$("#instructions-additional").fadeOut("750");$(a).trigger("step-updated",[p,h])}})})}}function g(){$editRow=$(".k-steps-editrow:first");$prevRow=$(".k-kit-step-editing:first");var h=$editRow.find(".kit-img-container:first");h.insertAfter($prevRow.find(".k-step-title-container:first"));$editRow.remove();$prevRow.removeClass("k-kit-step-editing")}c.oninit=function(){e=$("#kit-steps");$("#newstep-title").focus(function(){$("#instructions-additional").fadeIn("750")});c.manager.username=$("#kit").attr("data-username");c.manager.slug=$("#kit").attr("data-id");c.manager.token=$("#kit").attr("data-token");$(document).on("hover","#kit-steps tbody tr",function(h){if(!$(this).hasClass("k-steps-editrow")&&!$(this).hasClass("sortablerow")){if(h.type==="mouseenter"){$(".k-step-ctrls",this).show()}else{$(".k-step-ctrls",this).hide()}}});$("#kit-steps tbody").click(function(k){var j=$(k.target),h=j.parents("tr:first");if(j.hasClass("k-kit-ctrls-cancel")){g()}else{if(j.hasClass("k-kit-ctrls-edit")){g();h.addClass("k-kit-step-editing");d(h)}else{if(j.hasClass("k-kit-ctrls-delete")){var l=h.attr("data-id");if(l){a.Data.del("/"+c.manager.username+"/"+c.manager.slug+"/steps/"+l,{token:c.manager.token},function(m){h.fadeOut(function(){h.remove();$(a).trigger("step-deleted",[m.id])})})}}}}})};return c.pub}})(Kitify);(function(a){a.KitReorderStep=function(o){var j=a.Component({id:"kit"},o);var l=$("#kit-reorder-btn");var c=$("#kit-reorder-save-btn");var b=$("#kit-reorder-cancel-btn");var n=$("#kit-reorder-ctrls");var d=$("#kit-steps tbody");function m(){rows=d.children("tr").get();rows.sort(function(q,p){var s=$(q).attr("data-step");var r=$(p).attr("data-step");if(s>r){return 1}if(s<r){return -1}return 0});$.each(rows,function(p,q){d.append(q)})}function f(p){$.each(p,function(s,r){var t=s;var u=r;var q=d.children('tr[data-id="'+r+'"]');q.attr("data-step",s);q.find(".k-kit-step-num:first").text(s+") ")})}function h(){d.sortable("disable");d.children("tr").removeClass("sortablerow");$(".k-kit-reordering").removeClass("k-kit-reordering");l.show();n.addClass("hide")}function k(){$(".k-kit-step-num").each(function(){var q=$(this).parents("tr:first").index()+1;var p=$(this).siblings(".k-kit-step-order-edit");p.val(q)})}function g(q,v){var p=q.parents("tbody:first");var t=p.children("tr").length;var s=Math.max(Math.min(t,v),1);var r=q.index()+1;var u=p.children("tr").eq(s-1);if(r>s){q=q.insertBefore(u)}else{if(s>r){q=q.insertAfter(u)}}}function e(){$("#kit-reorder-ctrls").addClass("hide");l.click(function(){l.hide();n.removeClass("hide");$("#kit-steps tr").addClass("k-kit-reordering");$(".k-steps-editrow").remove();$(".k-kit-step-editing").removeClass("k-kit-step-editing");d.sortable({revert:true,helper:"original",opacity:0.5,update:function(){k()}});d.sortable("enable");d.children("tr").addClass("sortablerow");k()});c.click(function(){$(".k-kit-step-order-edit").each(function(){g($(this).parents("tr:first"),$(this).val())});var p={};d.children("tr").each(function(q){$(this).attr("data-step",q+1);p[q]={id:$(this).attr("data-id"),order:$(this).attr("data-step")}});a.Data.save("/"+j.pub.username+"/"+j.pub.slug+"/"+j.pub.token+"/steps/reorder",{order:p},function(q){if(q&&q.success){f(q.order);m();h()}})});b.click(function(){h()})}j.oninit=function(){j.pub.username=$("#"+j.options.id).attr("data-username");j.pub.slug=$("#"+j.options.id).attr("data-id");j.pub.token=$("#"+j.options.id).attr("data-token");e()};return j.pub}})(Kitify);(function(a){a.InstructionsHost=function(e){var d=a.Component({id:"kit"},e);var c=$("input:radio[name=host]");var b=$("#k-host-radio-parent");var j=$("#kit-instructions-location");var g=$("#kit-instructions-container");function h(){c.click(function(){var l=$("input:radio[name=host]:checked").val();var k=false;if(l=="khost"){k=true}a.Data.save("/"+d.pub.username+"/"+d.pub.slug+"/"+d.pub.token,{khost:k},function(m){if(m.success!==false){f(m.kit.khost)}})})}function f(k){k=="true"?k=true:b.attr("data-status",k);if(k==true){$("#ownhost").prop("checked",false);$("#khost").prop("checked",true);j.fadeOut("500",function(){g.fadeIn("500")})}else{$("#khost").prop("checked",false);$("#ownhost").prop("checked",true);g.fadeOut("500",function(){j.fadeIn("500")})}}d.oninit=function(){d.pub.username=$("#"+d.options.id).attr("data-username");d.pub.slug=$("#"+d.options.id).attr("data-id");d.pub.token=$("#"+d.options.id).attr("data-token");h();f(b.attr("data-status"))};return d.pub}})(Kitify);(function(a){a.KitItems=function(p){var k=a.Component({id:"kit",components:{}},p),m=[];var n=$("#kit-items");var e='<tr class="k-kit-items-none"><td colspan="7">Start adding items above.</td></tr>';var o='<tr class="k-kit-items-none"><td colspan="7">Start adding items above.</td></tr>';var f=['<tr data-id="{{id}}">','<td class="k-kit-items-col-name">{{name}}</td>','<td class="k-kit-items-col-image">','<div data-ftype="item" data-id="{{id}}" class="kit-img-container-mini kit-img-empty pull-left fileupload"></div>',"</td>",'<td class="k-kit-items-col-quantity">{{quantity}} {{units}}</td>','<td class="k-kit-items-col-link"><a href="{{merchant_url}}" target="_blank">{{merchant_url}}</a></td>','<td class="k-kit-items-col-optional">{{optional}}</td>','<td class="k-kit-items-col-notes">','{{#notes}}<i class="icon-comment cursor-pointer" data-content="{{notes}}"></i>{{/notes}}',"</td>",'<td class="k-kit-items-col-controls">','<div class="k-item-ctrls">','<a href="javascript:void(0)" class="k-kit-ctrls-edit btn btn-small btn-primary">edit</a>','<a href="javascript:void(0)" class="k-kit-ctrls-delete btn btn-small btn-danger">delete</a>',"</div>","</td>","</tr>"].join("");var h=['<tr">','<td class="k-kit-items-image">','{{#thumb_url}}<div data-id="{{id}}" data_url="{{url}}" class="kit-img-container-mini cursor-pointer">','<img class="kit-img" src="{{thumb_url}}">',"</img>","</div>{{/thumb_url}}","</td>",'<td class="k-kit-items-name">','{{#merchant_url}}<a href="{{merchant_url}}" target="_blank">{{/merchant_url}}',"{{name}}","{{#merchant_url}}</a>{{/merchant_url}}","</td>",'<td class="k-kit-items-quantity">{{quantity}} {{units}}</td>','<td class="k-kit-items-notes">',"{{notes}}","</td>","</tr>"].join("");var l=h;var b=e;if($("#kit").hasClass("editable")){l=f;b=o}function j(q){var r=$.extend(true,{},q);if(typeof q.price==="number"){r.price="$"+q.price.toFixed(2)}q.heavy?r.heavy="Yes":r.heavy="";q.optional?r.optional="Yes":r.optional="";return r}function c(q,r){var t=j(r),u=a.template(l,t);if($("#kit-items").hasClass("hasoptionals")){if($("#optional_divider").get(0)===undefined){var s=$('<tr id="optional_divider"><td colspan="4"><span id="divider_span">Optional items</span></td></tr>');s.appendTo(q)}s=$("#optional_divider");if(r.optional){$(u).insertAfter(s)}else{$(u).insertBefore(s)}}else{$(u).appendTo(q).data("item",r).find(".k-item-ctrls:first").hide()}q.find("i").popover();$(a).trigger("item-row-created",r)}function d(q,r){var s=j(r),t=a.template(l,s);q.replaceWith($(t).data("item",r));$(a).trigger("item-row-created",r)}function g(){var q=$("tbody",n).empty();if(m.length){$.each(m,function(r,s){s.price=parseFloat(s.price);c(q,s)});n.show();$(".k-item-ctrls").hide()}}k.oninit=function(){k.pub.username=$("#kit").attr("data-username");k.pub.slug=$("#kit").attr("data-id");k.pub.token=$("#kit").attr("data-token");a.Data.get("/"+k.pub.username+"/"+k.pub.slug+"/items",function(q){m=q;g()});$(a).bind("item-created",function(q,r){n.show();c($("tbody",n),r)});$(a).bind("item-updated",function(r,s,q){d(q,s)});$(a).bind("item-deleted",function(q,r){if(!$("tbody tr",n).length){n.hide()}})};return k.pub}})(Kitify);(function(a){a.NewItem=function(c){var b=a.Component({id:"newitem",fields:[{id:"newitem-name",prop:"name",label:"Item Name",required:true},{id:"newitem-quantity",prop:"quantity",label:"Quantity",validator:"positiveInteger",required:true},{id:"newitem-unittype",prop:"units",label:"Units",required:false,submit:true},{id:"newitem-merchanturl",prop:"merchant_url",label:"Web address",required:false,submit:true},{id:"newitem-optional",prop:"optional",label:"Optional",submit:true},{id:"newitem-notes",prop:"notes",label:"Notes",submit:true}]},c);b.oninit=function(){var d=a.Form.setup({context:"#newitem-add",fields:b.options.fields,btns:{submit:"#kit-add-item-btn"}});$(d).bind("submit",function(e,f){b.manager.username=$("#kit").attr("data-username");b.manager.slug=$("#kit").attr("data-id");b.manager.token=$("#kit").attr("data-token");f.token=b.manager.token;a.Data.save("/"+b.manager.username+"/"+b.manager.slug+"/items",f,function(g){if(g&&g.success!==false){d.reset();g.price=parseFloat(g.price);$(a).trigger("item-created",[g])}})})};return b.pub}})(Kitify);(function(a){a.EditItem=function(f){var c=a.Component({id:"edititem",fields:[{id:"item-name",prop:"name",label:"Item name",required:true,submit:true},{id:"item-quantity",prop:"quantity",label:"Quantity",required:true,submit:true},{id:"item-units",prop:"units",label:"Units",required:false,submit:true},{id:"item-merchanturl",label:"Web address",prop:"merchant_url",required:false,submit:true},{id:"item-heavy",label:"Heavy",prop:"heavy",required:false,submit:true},{id:"item-optional",label:"Optional",prop:"optional",required:false,submit:true},{id:"item-notes",label:"Notes",prop:"notes",submit:true}]},f);var e,g;var b=['<tr class="k-items-editrow">','<td class="k-kit-items-col-name">','<input type="text" id="item-name" value="{{name}}" class="span2" required /></td>','<td class="k-kit-items-col-image">','<div class="img-contain-placeholder"></div>',"</td>",'<td class="k-kit-items-col-number"><input id="item-quantity" value="{{quantity}}" class="span1" required /><input id="item-units" value="{{units}}" class="span1" /></td>','<td class="k-kit-items-col-link"><input type="url" id="item-merchanturl" value="{{merchant_url}}" class="required span2"/></td>','<td class="k-kit-items-col-optional"><input type="checkbox" id="item-optional" value="{{optional}}" {{#optional}}checked="checked"{{/optional}}/></td>',"</td>",'<td class="k-kit-items-col-notes">','<input type="text" id="item-notes" value="{{notes}}" class="span1" />',"</td>",'<td class="k-kit-items-col-controls">','<div class="k-item-ctrls">','<a href="javascript:void(0)" class="k-kit-ctrls-save btn btn-small btn-primary">save</a>','<a href="javascript:void(0)" class="k-kit-ctrls-cancel btn btn-small">cancel</a>',"</div>","</td>","</tr>"].join("");function d(j){var l=j.data("item");var m=j.find(".kit-img-container-mini:first");if(l){var n=$(a.template(b,l)).insertAfter(j);n.find(".img-contain-placeholder:first").replaceWith(m);var k=a.Form.setup({context:n,fields:c.options.fields,data:l,btns:{submit:$(".k-kit-ctrls-save",n)}});$(k).bind("submit",function(o,p){p.token=c.manager.token;a.Data.save("/"+c.manager.username+"/"+c.manager.slug+"/items/"+p.id,p,function(q){if(q&&q.success!==false){q.price=parseFloat(q.price);n.remove();$(a).trigger("item-updated",[q,j])}})})}}function h(){$editRow=$(".k-items-editrow:first");$prevRow=$(".k-kit-item-editing:first");var j=$editRow.find(".kit-img-container-mini:first");j.appendTo($prevRow.find(".k-kit-items-col-image"));$editRow.remove();$prevRow.removeClass("k-kit-item-editing")}c.oninit=function(){e=$("#kit-steps");c.manager.username=$("#kit").attr("data-username");c.manager.slug=$("#kit").attr("data-id");c.manager.token=$("#kit").attr("data-token");$(document).on("hover","#kit-items tbody tr",function(j){if(!$(this).hasClass("k-items-editrow")){if(j.type==="mouseenter"){$(".k-item-ctrls",this).show()}else{$(".k-item-ctrls",this).hide()}}});$("#kit-items tbody").click(function(l){var k=$(l.target),j=k.parents("tr:first");if(k.hasClass("k-kit-ctrls-cancel")){h()}else{if(k.hasClass("k-kit-ctrls-edit")){h();j.addClass("k-kit-item-editing");d(j)}else{if(k.hasClass("k-kit-ctrls-delete")){var m=j.attr("data-id");if(m){a.Data.del("/"+c.manager.username+"/"+c.manager.slug+"/items/"+m,{token:c.manager.token},function(n){j.fadeOut(function(){j.remove();$(a).trigger("item-deleted",[n.id])})})}}}}})};return c.pub}})(Kitify);(function(a){a.KitOptionals=function(e){var c=a.Component({id:"kit"},e);_items=[];var d;var g=['<tr data-id="{{id}}">','<td class="k-kit-items-col-name">{{name}}</td>','<td class="k-kit-items-col-quantity">{{quantity}} {{units}}</td>','<td class="k-kit-items-col-controls">','<div class="product"><input type="hidden" class="product-title" value="{{quantity}} {{units}} - {{name}}"><input type="hidden" class="product-price" value="{{price}}">','<span class="googlecart-add btn btn-small cart-add-btn" tabindex="0" role="button" title="Add to cart">\nAdd to Cart</span>',"</div></td>",'<td class="k-kit-items-col-notes">{{notes}}</td>',"</tr>"].join("");function f(j){var k=$.extend(true,{},j);if(typeof j.price==="number"){k.price="$"+j.price.toFixed(2)}j.heavy?k.heavy="Yes":k.heavy="";j.optional?k.optional="Yes":k.optional="";return k}function b(j,k){var l=f(k),m=a.template(g,l);$(m).appendTo(j).data("item",k)}function h(){var j=$("tbody",d).empty();$.each(_items,function(k,l){l.price=parseFloat(l.price);if(l.optional){b(j,l)}})}c.oninit=function(){c.pub.username=$("#"+c.options.id).attr("data-username");c.pub.slug=$("#"+c.options.id).attr("data-id");c.pub.token=$("#"+c.options.id).attr("data-token");d=$("#kit-optional-items");a.Data.get("/"+c.pub.username+"/"+c.pub.slug+"/items",function(j){_items=j;h()})};return c.pub}})(Kitify);(function(a){a.KitPublish=function(k){var g=a.Component({id:"kit"},k);var d=$("#kit-pub-btn");var j=$("#kit-delete-btn");var h=$("#del_confirm");var c=$("#unpub_insteadof_delete_btn");var f=$("#cancel_deletion");function e(){f.click(function(){$("#delete-modal").modal("hide")});c.click(function(){d.click();$("#delete-modal").modal("hide")});j.click(function(){$("#delete-modal").modal("show")});h.click(function(){a.Data.del("/"+g.manager.username+"/"+g.manager.slug+"/"+g.manager.token,"",function(l){if(l.success&&l.success!=false){$("#delete-modal").modal("hide");$("#post-delete-modal").modal("show")}})});d.click(function(){d.attr("data-status")=="unpublished"?next_state="waiting":next_state="unpublished";a.Data.save("/"+g.pub.username+"/"+g.pub.slug+"/"+g.pub.token,{published:next_state},function(l){if(l.success!==false){b(l.kit.published)}})})}function b(l){d.attr("data-status",l);switch(l){default:break;case"published":d.text("Cancel sales");d.removeClass("btn-success").addClass("btn-error");$("#kit-pub-warn").removeClass("hide");$(".unpub_suggestion").removeClass("hide");$("#k-kit-selling-text").removeClass("hide");$("#k-kit-notselling-text").addClass("hide");break;case"waiting":d.text("Cancel review");d.removeClass("btn-success").addClass("btn-error");$("#kit-pub-warn").removeClass("hide");$(".unpub_suggestion").removeClass("hide");$("#k-kit-selling-text").addClass("hide");$("#k-kit-notselling-text").removeClass("hide");break;case"unpublished":d.text("Sell this kit with Kitify");d.removeClass("btn-error").addClass("btn-success");$("#kit-pub-warn").addClass("hide");$(".unpub_suggestion").addClass("hide");$("#k-kit-selling-text").addClass("hide");$("#k-kit-notselling-text").removeClass("hide");break}}g.oninit=function(){g.pub.username=$("#"+g.options.id).attr("data-username");g.pub.slug=$("#"+g.options.id).attr("data-id");g.pub.token=$("#"+g.options.id).attr("data-token");e();b(d.attr("data-status"))};return g.pub}})(Kitify);(function(a){a.KitParams=function(c){var b=a.Component({id:"kit-params"},c);function d(e){var k=e.val();var j=e.attr("id").replace("kit-","");var h=e.attr("data_prev_val");var g=true;var f={};if(k!=h&&g){f[j]=k;a.Data.save("/"+b.manager.username+"/"+b.manager.slug+"/"+b.manager.token,f,function(l){if(l.success!==false){e.attr("data_prev_val",e.val())}if(l.success=="redirect"){window.location.href="/"+b.manager.username+"/"+l.kit.slug+"/"+l.kit.token}})}}b.oninit=function(){$(".k-param-input").each(function(){var e=$(this);e.attr("data_prev_val",e.val());e.blur(function(){d(e)}).keyup(function(f){if(f.which===13){console.log(f);d(e)}})})};return b.pub}})(Kitify);(function(a){a.KitImage=function(n){var h=a.Component({id:"kit",components:{}},n);var k=[];var f=['<a class="btn btn-small btn-success upload-trigger"><i class="icon-plus-sign"></i></a>','<div class="popup-loader hide k-shadow">','<a class="close">×</a>','<span class="fileinput-button">','<input type="file" name="files" multiple="false"></input>','<div class="progressbar progress progress-striped active">','<div style="width:0%;" class="bar"></div>',"</div>","</span>","</div>"].join("");var d=['<img class="kit-img" src={{thumb_url}}></img>','<div class="kit-img-control">','<i data_id="{{att_id}}" rel="nofollow" class="icon-remove cursor-pointer"></i>','<i data_url="{{url}}" class="icon-zoom-in cursor-pointer"></i>',"</div>"].join("");function b(q,o){if(o.url||o.thumb_url){var p=$(a.template(d,o));q.removeClass("kit-img-empty").empty().append(p);m()}else{c(q)}}function c(q){q.empty().append($(f)).addClass("kit-img-empty");if(q.parent().attr("#kit-img-div")){q.appendTo(q.parent())}var p=q.attr("data-ftype");var o=q.attr("data-id");upload_options_type=$.extend({},g,{formData:{type:p,ps_id:o}});$upload_anchor=q.find(".fileinput-button:first");$upload_anchor.fileupload("destroy");$upload_anchor.fileupload(upload_options_type);$trigger=q.find(".upload-trigger:first");$trigger.on("click",function(){$loader=q.find(".popup-loader:first");$loader.toggleClass("hide");$(".popup-loader").not($loader).addClass("hide")});$close=q.find(".close:first");$close.on("click",function(){$loader=q.find(".popup-loader:first");$loader.toggleClass("hide");$(".popup-loader").not($loader).addClass("hide")})}function l(p,o){a.Data.del("/"+h.pub.username+"/"+h.pub.slug+"/"+h.pub.token+"/attachments/"+p,function(q){if(q&&q.success){c(o)}else{Kitify.Message.show(data.result["message"],"error")}})}function e(o,p){$("#modal-image").attr("src",o);$("#kit-image-modal").css("margin-left",($("#kit-image-modal").outerWidth()/2)*-1).modal("show")}var g={url:(window.location.href).replace(location.hash,"").replace("#","")+"/attachments/",autoUpload:true,type:"POST",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:"3000000",sequentialUploads:true,singleFileUploads:true,timeout:"30000",add:function(p,o){$o=$(this).data("fileupload").options;file=o.originalFiles[0];if(!($o.acceptFileTypes.test(file.type)||$o.acceptFileTypes.test(file.name))){file.error="acceptFileTypes";p.data.fileupload._trigger("fail",p,o)}if($o.maxFileSize&&file.size>$o.maxFileSize){file.error="maxFileSize";p.data.fileupload._trigger("fail",p,o)}else{o.submit()}},fail:function(p,o){$o=$(this).data("fileupload").options;if(o.originalFiles[0].error=="maxFileSize"){Kitify.Message.show("Sorry, this file is too big. The maximum upload size is "+(($o.maxFileSize)/1000000).toFixed(1)+" megabytes.","error")}if(o.originalFiles[0].error=="acceptFileTypes"){Kitify.Message.show("Sorry, this type of file isn't allowed.","error")}else{if(o.errorThrown=="timeout"){Kitify.Message.show("Sorry, the server took too long to respond. Please try again; uploading a smaller file might help.","error")}else{Kitify.Message.show("There was an error uploading your file.","error")}}$target=$(p.target);$target=$($target.get(0));done=parseInt(0);$target.parents('[class*="kit-img-container"]:first').find(".bar:first").css("width",done+"%");setTimeout(function(){$(".k-header-notice").removeClass("k-header-notice-saving").fadeOut("750")},1500)},send:function(p,o){console.log(o);if(o.dataType.substr(0,6)=="iframe"){$(".k-header-notice-text").children("span:first").text("Working...");$(".k-header-notice").addClass("k-header-notice-saving").fadeIn("750");$("#kitify-ajax-img").show();$(".progress").css("visibility","hidden");$target=$(p.target);$target=$($target.get(0));$target.parents('[class*="kit-img-container"]:first').find(".bar:first").css("width","100%")}},progress:function(p,o){$target=$(p.target);$target=$($target.get(0));done=parseInt(100*p.loaded/p.total);$target.parents('[class*="kit-img-container"]:first').find(".bar:first").css("width",done+"%")},done:function(p,o){setTimeout(function(){$(".k-header-notice").removeClass("k-header-notice-saving").fadeOut("750")},1500);$target=$(p.target);$container=$($target.parents('[class*="kit-img-container"]:first').get(0));if(o.result["success"]){b($container,o.result["attachments"])}else{Kitify.Message.show(o.result["message"],"error");$target.parents('[class*="kit-img-container"]:first').find(".bar:first").css("width","0%")}}};function m(){$(".kit-img-control").unbind();$(".kit-img-control").on("click",function(q){var o=$(q.target);var p=o.parents(".kit-img-container:first");if(p[0]===undefined){p=o.parents(".kit-img-container-mini:first")}j(o,p)});if(!$("#kit").hasClass("editable")){$(".kit-img-control").remove();$(".kit-img-container-mini").click(function(){e($(this).attr("data_url"))});$(".kit-img-container").click(function(){e($(this).attr("data_url"))})}}function j(o,p){if(o.hasClass("icon-remove")){l(o.attr("data_id"),p)}else{if(o.hasClass("icon-zoom-in")){e(o.attr("data_url"))}}}h.oninit=function(){h.pub.username=$("#kit").attr("data-username");h.pub.slug=$("#kit").attr("data-id");h.pub.token=$("#kit").attr("data-token");$(".kit-img-empty").each(function(){c($(this))});a.Data.get("/"+h.pub.username+"/"+h.pub.slug+"/attachments",function(o){$.each(o.attachments,function(q,p){var r=$("#kit-img-div").children(".kit-img-empty:first");b(r,p);m()})});$(a).bind("step-row-created",function(o,p){c($("#step-img-upload"));$step_row=$("#kit-steps").find('tr[data-id="'+p.id+'"]');$container=$step_row.find(".kit-img-container:first");b($container,p)});$(a).bind("item-row-created",function(o,p){c($("#item-img-upload"));$item_row=$("#kit-items").find('tr[data-id="'+p.id+'"]');$container=$item_row.find(".kit-img-container-mini:first");b($container,p)})};return h.pub}})(Kitify);(function(a){a.KitCustomize=function(s){var j=a.Component({id:"kit-customize"},s);var q=tinycolor;var o={};var l=["Acme","Amethysta","Creepster","Cutive","Engagement","Ewert","Frijole","Fugaz","Limelight","Mystery Quest","Sevillana","Simonetta","Quicksand"];var c=['<div class="swatch_chooser_container">',Array(11).join('<div class="swatch_chooser"></div>'),"</div>"].join("");var d=['<div class="flat-slider">','<div class="colorslider red"></div>','<div class="colorslider green"></div>','<div class="colorslider blue"></div>',"</div>"].join("");var g=['<div class="default_chooser">',"</div>"].join("");var e=['<div class="btn-group fontpicker">','<a class="btn btn-large fontpicker-display" href="javascript:void(0);">Font</a>','<a class="btn btn-large dropdown-toggle" data-toggle="dropdown" href="javascript:void(0);">','<span class="caret"></span>',"</a>",'<ul class="dropdown-menu font-list">','<li><a class="font_entry" href="javascript:void(0);" data-font="" style:"font-family: "";">Default</a></li>',"</ul>","</div>"].join("");var b={"color-swatches":c,"color-slider":d,"font-chooser":e,"default-chooser":g};function f(t){var w={};id=t.attr("id");w[id]={};var v=t.css("background-color");w[id].background_color=q(v).toHexString();if(w[id].background_color=="#000"){w[id].background_color="none"}if(w[id].background_color=="#333"){w[id].background_color="none"}var u=t.css("color");w[id].color=q(u).toHexString();if(w[id].color=="#000"){w[id].color="none"}if(w[id].color=="#333"){w[id].color="none"}if(t.css("background-image")&&(t.css("background-image")!="none")){w[id].background_image=true}else{w[id].background_image="none"}w[id].font_family=t.attr("data-font");w={customizations:w};a.Data.save("/"+j.manager.username+"/"+j.manager.slug+"/"+j.manager.token+"/customizations",w,function(x){})}function h(){$("#k-kit-customize tbody").click(function(v){var u=$(v.target);if(u.hasClass("default_chooser")){$s=u.parents(".customize-controls").siblings(".swatch");$s.css("background-image","").css("background-color","").css("color","").css("font-family","");$s.attr("data-font","");p_swatch_class="."+$s.attr("id").replace("k-","p-");$(p_swatch_class).css("background-image","").css("background-color","").css("color","").css("font-family","");f($s);$d=u.parents(".customize-controls").find(".icon-remove:first");$d.trigger("click")}if(u.hasClass("kit-img")){$s=u.parents(".customize-controls").siblings(".swatch");var t=u.attr("src");t="url("+t+")";$s.css("background-image",t);$s.css("background-color","none");$s.css("color","none");p_swatch_class="."+$s.attr("id").replace("k-","p-");$(p_swatch_class).css("background-image",t);$(p_swatch_class).css("background-color","none");$(p_swatch_class).css("color","none");f($s)}if(u.hasClass("swatch_chooser")){var w=u.css("background-color");if(q(w).toHexString()=="#000"){w="#000001"}if(q(w).toHexString()=="#333"){w="#333334"}$s=u.parents(".customize-controls").siblings(".swatch");p_swatch_class="."+$s.attr("id").replace("k-","p-");if(p_swatch_class==".p-swatch-title"){$s.css("color",w);$(p_swatch_class).css("color",w)}else{$s.css("background-color",w);$s.css("background-image","none");$(p_swatch_class).css("background-color",w);$(p_swatch_class).css("background-image","none")}f($s);$d=u.parents(".customize-controls").find(".icon-remove:first");$d.trigger("click")}if(u.hasClass("font_entry")){$chooser=u.parents("ul:first").siblings(".fontpicker-display:first");chooser_fontfam=u.css("font-family");$chooser.text(u.text());$chooser.css("font-family",chooser_fontfam);$s=$chooser.parents(".controls:first").children(".swatch:first");$s.attr("data-font",chooser_fontfam);$s.css("font-family",chooser_fontfam);p_swatch_class="."+$s.attr("id").replace("k-","p-");$(p_swatch_class).css("font-family",chooser_fontfam);$(p_swatch_class).attr("data-font",chooser_fontfam);f($s)}})}function p(){var v=$(".colorslider.red").slider("value");var u=$(".colorslider.green").slider("value");var t=$(".colorslider.blue").slider("value");var w=tinycolor("rgb "+v+","+u+","+t);adjust_array=[q.lighten(w,0),q.lighten(w,20),q.darken(w,20),q.analogous(w)[1],q.analogous(w)[2],q.triad(w)[1],q.triad(w)[2],q.tetrad(w)[1],q.tetrad(w)[2],q.tetrad(w)[3],q.darken(w,255),q.lighten(w,255)];$("#k-swatch-scheme").css("background-color",w.toHexString());$(".swatch_chooser_container").each(function(){$sc=$(this).children(".swatch_chooser");for(var x=0;x<adjust_array.length;x++){$sc.eq(x).css("background-color",adjust_array[x].toHexString())}})}function n(){WebFontConfig={google:{families:l},active:function(){k()},inactive:function(){$(".fontpicker").remove()}}}function k(){var t=[];for(i in l){$new_item=$('<a class="font_entry" href="javascript:void(0);">'+l[i]+"</a>");$new_item.attr("data-font",l[i]);$new_item.css("font-family",'"'+l[i]+'", sans-serif');$new_item=$("<li></li>").append($new_item);t.push($new_item.get(0))}$(".fontpicker").children(".font-list").append($(t))}function m(){a.Data.get("/"+j.pub.username+"/"+j.pub.slug+"/customizations",function(t){$.each(t,function(){this.property=this.property.replace("_","-");$("#"+this.element).css(this.property,this.value);$("."+this.element.replace("k-","p-")).css(this.property,this.value)})})}function r(){a.Data.get("/"+j.pub.username+"/"+j.pub.slug+"/customizations",function(t){$.each(t,function(){this.property=this.property.replace("_","-");el=this.element.replace("k-swatch-","");if(el=="app-bg"){el="#container"}if(el=="kit-bg"){el="#content-inner"}if(el=="title"){el="#title"}if(el=="table-items"){el="tr"}if(el=="table-headers"){el="th"}$(el).css(this.property,this.value)})})}j.oninit=function(){j.pub.username=$("#kit").attr("data-username");j.pub.slug=$("#kit").attr("data-id");j.pub.token=$("#kit").attr("data-token");n();$(".customize-controls").each(function(){var u=$(this).attr("class").split(" ");for(var t=0;t<u.length;t++){$(this).append(b[u[t]])}$(this).append($(this).children(".default_chooser"));$(this).append($(this).children(".kit-img-container-mini"))});$(".colorslider").slider({orientation:"horizontal",range:"min",max:255,value:127,slide:p,change:p});p();h();if($("#kit").hasClass("editable")){m()}else{r()}};return j.pub}})(Kitify);(function(a){a.KitNav=function(c){var b=a.Component({id:"kitnav",components:{}},c);b.oninit=function(){b.pub.username=$("#kit").attr("data-username");b.pub.slug=$("#kit").attr("data-id");b.pub.token=$("#kit").attr("data-token");$("#k-kit-nav a").on("click",function(e){var d=$(e.target);var g=$("#k-kit-"+d.attr("data-section"));var f=$(".activesection");if(f[0]===undefined){f=$(".k-kit-section:first")}if(!g.hasClass("activesection")){f.removeClass("activesection").fadeOut("500",function(){g.addClass("activesection").fadeIn("500")})}});$("#k-kit-nav").find("a:first").click()};return b.pub}})(Kitify);